<html>

<!-- Mirrored from www.cprogramming.com/tutorial/binarysearchbugs.html by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 10 Sep 2012 23:40:15 GMT -->
<head>
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds2.feedburner.com/Cprogrammingcom/">
<link rel="stylesheet" href="http://static.cprogramming.com/main_images/style.css?np9" type="text/css">
<!--[if IE]>
    <link rel="stylesheet" href="http://static.cprogramming.com/main_images/style-ie.css?np4" type="text/css">
<![endif]-->


<META NAME="keywords" CONTENT="binary search, debugging binary search, bin search, searching, finding bugs, bug hunting programming, bug hunting">
<META NAME="Description" CONTENT="Just how easy is it to implement binary search correctly?">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Binary Search Code Analysis - Cprogramming.com</title>

<!-- ADDED DFP -->
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'>
</script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-2560316224908115");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-2560316224908115", "RunOfSite_LargeRectangle_ATF_336x280");
GA_googleAddSlot("ca-pub-2560316224908115", "RunOfSite_ATF_leaderboard_728x90");

</script>
<script type='text/javascript'>
GA_googleFetchAds();
</script>
<!-- END ADDED DFP -->


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7820175-1']);
  _gaq.push(['_setDomainName', '.cprogramming.com']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</head>

<body>
<div>

<a href="../index.html"><img class="logo noprint" src="http://static.cprogramming.com/main_images/title.png" width="324" height="83" border="0"></a> 

<table class="line noprint"><tr><td></td></tr></table>
<div class="noprint" align="right" style="padding-top:25px;padding-right:25px;">
<!-- SiteSearch Google -->
<form action="http://www.google.com/cse" id="cse-search-box">
  <div>
    <input type="hidden" name="cx" value="partner-pub-2560316224908115:wqvdce-aw4a" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="31" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&amp;lang=en"></script>
<!-- SiteSearch Google -->
</div>
<div>
  <table class="main">
    <tr>

  	<td class="noprint" colspan="5" bgcolor="#EBEBEB">
  		<img src="http://static.cprogramming.com/main_images/spacer-vert.png" height="6" width="0">
  	   <center>
    	<div class="leaderboard">

<!-- ADDED DFP -->
<!-- ca-pub-2560316224908115/Homepage_ATF_leaderboard_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("RunOfSite_ATF_leaderboard_728x90");
</script>
<!-- END ADDED DFP -->

</div>
		</center>
		<img src="http://static.cprogramming.com/main_images/spacer-vert.png" height="4" width="1">
  	</td>
        
  </tr>

  <tr>

     <td class="noprint" width="130" valign="top" bgcolor="#EBEBEB"> 
     <div class="menu" valign="top" style="font-size:14px;width:200px">
     <p class="navcategory" align="left">
          <img class="bullet" src="http://static.cprogramming.com/main_images/bullet.gif" width="11" height="14">    Starting out
     </p>

     <p class="navlist" align="left" style="font-size:14px;">
             <a href="../c%2b%2bbook/index5969.html?inl=sb">Get the Ebook</a><br>
             <a href="../begin.html">Get Started with C or C++</a><br>
             <a href="../compilers.html">Getting a Compiler</a><br>
             <a href="../books.html">Book Recommendations</a><br>
     </p>

     <p class="navcategory" align="left">
          <br>
          <img class="bullet" src="http://static.cprogramming.com/main_images/bullet.gif" width="11" height="14"> Tutorials
     </p>

     <p class="navlist" align="left" style="font-size:14px;">
            <a href=c-tutorial.html>C Tutorial</a><br>
            <a href=c%2b%2b-tutorial.html>C++ Tutorial</a><br>
            <a href=../java-programming.html>Java Tutorial</a><br>
            <a href=../game-programming.html>Game Programming</a><br>
            <a href=../graphics-programming.html>Graphics Programming</a><br>
            <a href=../algorithms-and-data-structures.html>Algorithms &amp; Data Structures</a><br>
            <a href=../debuggers.html>Debugging</a><br>
            <a href="../tutorial.html">All Tutorials</a><br>
     </p>

     <p class="navcategory" align="left">
          <br>
          <img class="bullet" src="http://static.cprogramming.com/main_images/bullet.gif" width="11" height="14"> Practice
     </p>

     <p class="navlist" align="left" style="font-size:14px;">
            <a href="../challenge.html">Practice Problems</a><br>
            <a href="../quiz/index.html">Quizzes</a><br>
     </p>
     <p class="navcategory" align="left">
          <br>
          <img class="bullet" src="http://static.cprogramming.com/main_images/bullet.gif" width="11" height="14"> Resources
     </p>

     <p class="navlist" align="left" style="font-size:14px;">
            <a href="../cgi-bin/source/source.html">Source Code</a><br>
            <a href=../snippets/index.html>Source Code Snippets</a><br>
            <a href="../tips/index.html">C and C++ Tips</a><br>
            <a href=../jobs/index.html>Finding a Job</a>
     </p>

     <p class="navcategory" align="left">
          <br>
          <img class="bullet" src="http://static.cprogramming.com/main_images/bullet.gif" width="11" height="14"> References
     </p>

     <p class="navlist" align="left" style="font-size:14px;">
            <a href="../function.html">Function Reference</a><br>
            <a href="../reference/index.html">Syntax Reference</a><br>
            <a href="../cgi-bin/cdir/Cdirectory.html">Programming Links</a><br>
            <a href="http://faq.cprogramming.com/cgi-bin/smartfaq.cgi">Programming FAQ</a><br>
     </p>

     <p class="navcategory" align="left">
          <br>
          <img class="bullet" src="http://static.cprogramming.com/main_images/bullet.gif" width="11" height="14"> Getting Help
     </p>

     <p class="navlist" align="left" style="font-size:14px;">
             <a href="../board.html">Message Board</a><br>
             <a href="../expert.html">Ask an Expert</a><br>
             <a href="../email.html">Email</a><br>
             <a href="../about.html">About Us</a>
     </p>
     </div>

<center>
      <br><br>
     <script type="text/javascript"><!--
     google_ad_client = "pub-2560316224908115";
     google_ad_width = 120;
     google_ad_height = 90;
     google_ad_format = "120x90_0ads_al";
     google_ad_channel ="0800879710";
     google_color_border = "EBEBEB";
     google_color_bg = "EBEBEB";
     google_color_link = "C30000";
     google_color_url = "C30000";
     google_color_text = "000000";
     //--></script>
     <script type="text/javascript"
       src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
       </script>
</center>



    </td>
	<td class="content" valign="top">

    			<div class="content2">

<h1>Analysis of a Binary Search Function</h1>

<div style="margin-right: 1em; float:left; padding: .4em; border-right: 1px solid #bbb"><img src=http://static.cprogramming.com/main_images/alex-50-50.jpg height="50" width="50" border=0 style="padding: 0.25em;"><br><a href=https://plus.google.com/113987539774523532573?rel=author> By Alex Allain</a></div>

So how did you do?  Did you notice that it doesn't compile?  My friend put his function declarations out of order -- oops!  Within minutes, he received this email:
<pre class="example">
To: Joe
From: Me
Subject: Re: Untested Code
Sorry Joe, it doesn't compile!
</pre>

Not wanting to win on what I still considered a technicality (I did offer him
the chance to compile it!) I fixed his first bug and began a little bit of
black box testing.  (I had glanced over his search code looking for bugs, but
nothing horrible stood out at me.  In fact, it worked for the first few tests
-- a couple of softballs, such as giving the list "1 2 3 4 5" and searching for
the number 3 -- or looking for elements that didn't exist.

<br><br>
Then I decided to throw something a little bit trickier at his code: multiple copies of the same input: "4 4 4 4" and have it search for an element that wasn't in the list: 3.  Success!  A stack overflow.  

<br><br>
Now, what did he do wrong?  I spent a little bit of time testing other
combinations of input, but his code wasn't terribly predictable, and testing
without looking at the source code was getting a bit tedious.  I went back, and started to check his recursion.

<br><br>
Base case?  The base cases looked OK. I noticed that he had one extra base case: "if(start==end-1) ...", but it wouldn't cause a stack overflow.  So if the termination conditions are correct, what could possibly be wrong?

<br><br>
There had to be a problem with the recursive calls -- they must not be making
the problem simpler every time.  The most obvious thing to check is whether
he's correctly computing the new subarray.  Is the current midpoint being
included in the subarray?  Nope, it isn't.  He got that right.  In fact, his
extraneous base case would have protected him from any problems with that
(exercise for the reader: <a href="why.html">why</a>).  This is a subtle bug, but
not one that tripped him up.

<br><br>
So what's wrong?  If you haven't found it yet, go back and spend some time
going very carefully over his code, paying particular attention to his variable
names and function parameters.  

<br><br>
It turns out that he passes in the wrong value to the recursive calls.  Instead
of passing in the correct bounds for the array (either the midpoint + 1 or the
midpoint - 1), midInd, he passes midVal.  Amazingly, on some test cases this
works -- including simple inputs such as "0 1 2 3 4".  I'd probably have caught
this earlier if some of my test cases had included larger values stored in the
array -- when testing, try extremes even when it "shouldn't matter".  It often does.

<br><br>
Finally, the third bug is that he never checks for size 0 arrays.  Allocating 0 bytes of memory:
<pre class="example">
int *x = new int[0];
</pre>

will return a valid pointer, but not one that you are allowed to dereference.  Testing for this would have been easy in the first binary search helper function.

<br><br><b>Taking Stock of the Situation</b>

<br><br>
Do all these mistakes in such a "simple" program mean my friend is a bad
programmer?  Not at all.  The first bug would have been caught easily once he
compiled the code.  The second bug was so easy to find precisely because my
friend is a good programmer and used <a href="../tips/tip/use-good-variable-and-function-names.html?tip=9&amp;count=30&amp;page=0">good
variable names</a>.  If he hadn't, I would have spent a lot longer scratching
my head trying to figure out what was going wrong.  Instead, because the use of
the variable didn't correspond to the name of the variable, I was able to
pinpoint his bug almost immediately once I knew where to look.

<br><br>
The third bug, not handling zero element arrays, would have been easy to find
by inspection once you start to consider corner cases.  This is perhaps the
only bug I can really fault him for -- it's non-trivial, since you shouldn't
dereference a pointer returned from new when the size is 0 (it's a "unique
pointer" with size 0, and safe to pass to delete, but not safe to dereference).

<br><br><b>What to Take Away</b>

<br><br>
How did I know that my friend would have so much trouble with such a simple
program?  First, perfect programming is hard -- even the best programmers make
mistakes.  Second, my experiences have reinforced the old adage that a line of
code that you haven't tested is a line of code with a bug.  But I had one other
secret: experimental evidence.

<br><br>
In Jon Bentley's classic work, <a href="http://www.amazon.com/exec/obidos/ASIN/0201657880/lynnallain">Programming
Pearls</a>, he gives the task of implementing a correct binary search as an
apparently simple, but surprisingly difficult challenge.  He mentions that of
the large number of professional programmers whom he's challenged to write a
bug-free binary search, fewer than 50% get it right on the first try (in fact,
it's much closer to 10%).

<br><br>
Perhaps more surprising still is that, according to Donald Knuth in <a href="http://www.amazon.com/exec/obidos/ASIN/0201485419/lynnallain">The Art of
Computer Programming</a>, it was over ten years after the first publication of
a binary search algorithm that fully general solution was published.  In
programming, nothing is quite as simple as it seems (try <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">this
article on leaky abstractions</a> for another take).

<br><br>
Would I use my friend's code with the modifications I have suggested?  Maybe, but I'd be tempted to look up valid binary search code from a more rigorously vetted reference, used and checked by more than one programmer.

<br><br>
I leave you with a quote from Knuth, describing some code he had written in a
memo: "Beware of bugs in the above code; I have only proved it correct, not
tried it."
<br><br>
Oh -- and yes, Joe did take me out to lunch.  I have a lovely veggie burger.
He just had an appetizer...knowing now that even a simple program is a lot to
chew on.

 
<hr>
<b>Related articles
<br><br><a href="../discussionarticles/sorting_and_searching.html">Learn
more about search techniques</a>
<br><br><a href="computersciencetheory/sortcomp.html">Learn
more about the various sorting algorithms</a></b>
 
                

     

<div id="footer" class="noprint">

<div id="social" style="margin-top:5px;height:23px;">
<table>
<tr>
<td> 
<div id="fb-root"></div>
<div id="fb-recommend" class="fb-like" data-send="false" data-width="120" data-height="21" data-layout="button_count" data-action="recommend"></div>
</td>
<td>
<a class="twitter-share-button" data-count="horizontal" data-via="alexallain"></a>
</td>
<td>
<div class="g-plusone" data-size="medium"></div>
</td>
</tr>
</table>
</div>

<div style="font-size:14px;padding:10px;margin-top:5px;margin-bottom:5px;">
<div style="width:400px;margin-top:5px">
<div style="float:left"><a href=../c%2b%2bbook/index65a0.html?inl=ft-nhp><img src=../c%2b%2bbook/small_3d.jpg border=0></a></div>Want to become a C++ programmer? The Cprogramming.com ebook, Jumping into C++, will walk you through it, step-by-step. <a href=../c%2b%2bbook/index65a0.html?inl=ft-nhp>Get Jumping into C++ today!</a>
</div>
<div style="clear: both"></div>

<b>Popular pages</b>
<ul>
 <li><a href=../begin.html>Exactly how to get started with C++ (or C) today</a> 
<li><a href=c-tutorial.html>C Tutorial</a>
<li><a href=c%2b%2b-tutorial.html>C++ Tutorial</a>
<li><a href=../how_to_learn_to_program.html>5 ways you can learn to program faster</a> 
<li><a href=../beginner_programming_mistakes.html>The 5 Most Common Problems New Programmers Face</a>
<li><a href=../code_blocks/index.html>How to set up a compiler</a>
<li><a href=common.html>8 Common programming Mistakes</a> 
<li><a href=../c%2b%2b11/what-is-c%2b%2b0x.html>What is C++11?</a>
<li><a href=game_programming/same_game_part1.html>How to make a game in 48 hours</a>
</ul>

<b>Recent additions</b> <a href="http://feeds2.feedburner.com/Cprogrammingcom" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="subscribe to a feed" style="border:0" width="16" height="16"></img></a>
<ul>
<li><a href=shared-libraries-linux-gcc.html>How to create a shared library on Linux with GCC</a> - December 30, 2011</li>
<li> <a href="../c%2b%2b11/c%2b%2b11-nullptr-strongly-typed-enum-class.html">Enum classes and nullptr in C++11</a> - November 27, 2011</li>
<li><a href="computersciencetheory/hash-table.html">Learn about The Hash Table</a> - November 20, 2011</li>
<li><a href="../c%2b%2b11/rvalue-references-and-move-semantics-in-c%2b%2b11.html">Rvalue References and Move Semantics in C++11</a> - November 13, 2011</li>
<li><a href="../java/c-and-c%2b%2b-for-java-programmers.html">C and C++ for Java Programmers</a> - November 5, 2011</li>
<li><a href="c%2b%2b-iostreams.html">A Gentle Introduction to C++ IO Streams</a> - October 10, 2011</li>
</ul>

</div>
<style type="text/css">
@import url(http://www.google.com/cse/api/branding.css);
</style>
<div class="cse-branding-bottom" style="background-color:#FFFFFF;color:#000000;width:50%; margin:auto">
  <div class="cse-branding-form">
    <form action="http://www.google.com/cse" id="cse-search-box">
      <div>
        <input type="hidden" name="cx" value="partner-pub-2560316224908115:0581759109" />
        <input type="hidden" name="ie" value="UTF-8" />
        <input type="text" name="q" size="55" />
        <input type="submit" name="sa" value="Search" />
      </div>
    </form>
  </div>
  <div class="cse-branding-logo">
    <img src="http://www.google.com/images/poweredby_transparent/poweredby_FFFFFF.gif" alt="Google" />
  </div>
  <div class="cse-branding-text">
    Custom Search
  </div>
</div>

<center>
<div style="margin-top:20px; margin-bottom: 20px">
<script type="text/javascript">
<!--
google_ad_client = "pub-2560316224908115";
/* link_ads_bottom */
google_ad_slot = "2258412831";
google_ad_width = 728;
google_ad_height = 15;
//-->
</script> 
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"> </script> 
</div>
 
<script type="text/javascript" src="http://forms.aweber.com/form/12/618210012.js"></script>

<div class="footer-links" style="padding:10px">
<a href="../advertising.html">Advertising</a> | <a href="../privacy.html">Privacy policy</a> |
<a href="../use.html">Copyright © 1997-2011 Cprogramming.com. All rights reserved.</a> | <a href=mailto:webmaster@cprogramming.com>webmaster@cprogramming.com</a>
</div>
</div>
</div>
</td>
    	


<td class="content noprint" valign="top" rowspan="1" bgcolor="#EBEBEB">
<div class="content2"><br><div class="verticalad">







<script type="text/javascript"><!--
        e9 = new Object();
    e9.size = "160x600,120x600";
//--></script>
<script type="text/javascript" src="http://tags.expo9.exponential.com/tags/Cprogrammingcom/ROS/tags.js"></script>



</div><br>

<style type="text/css">
.sidebar-box { width: 150px; margin-bottom:5px; }
</style>
    <div id="side-images">
        <div style="padding:5px;margin-top:5px">
            <div style="margin-bottom: 5px">
                <b>Popular pages</b>
            </div>
            <div>
                
                <!--http://www.flickr.com/photos/baslow/5620208/sizes/o/in/photostream/ -->
                <div class = "sidebar-box">
                    <a href=c-tutorial.html>
                    <img src=http://static.cprogramming.com/main_images/footer/5620208_bff9c514e6_s.jpg border=0 height=75 width=75 alt="C tutorial">
                    <br>
                    C Tutorial
                    </a>
                </div>
                

                
                <!--http://www.flickr.com/photos/29233640@N07/2855530649/sizes/sq/in/photostream/-->
                <div class = "sidebar-box">
                    <a href=../begin.html>
                    <img src=http://static.cprogramming.com/main_images/footer/2855530649_905f7862fd_s.jpg border=0 height=75 width=75 alt="Get started">
                    <br>
                    Exactly how to get started with C++ (or C) today</a>
                </div>
                

                
                <!--http://www.flickr.com/photos/mikecogh/6505012533/sizes/sq/in/photostream/-->
                <div class = "sidebar-box">
                    <a href=../how_to_learn_to_program.html>
                    <img src=http://static.cprogramming.com/main_images/footer/6505012533_55c83fdfa0_s.jpg border=0 height=75 width=75 alt="Learn to program">
                    <br>
                    5 ways you can learn to program faster</a>
                </div>
                

                
                <div class = "sidebar-box">
                    <a href=c%2b%2b-tutorial.html>
                    <img src=http://static.cprogramming.com/main_images/footer/c++-img.png border=0 height=75 width=75 alt="C++ tutorial">
                    <br>
                    C++ Tutorial</a>
                </div>
                

                
                <!--http://www.flickr.com/photos/giopuo/3441263816/sizes/sq/in/photostream/-->
                <div class = "sidebar-box">
                    <a href=../beginner_programming_mistakes.html>
                    <img src=http://static.cprogramming.com/main_images/footer/3441263816_95f132a884_s.jpg border=0 height=75 width=75 alt="Problems new programmers face">
                    <br>
                    The 5 Most Common Problems New Programmers Face</a>
                </div>
                

                
                <div class = "sidebar-box">
                   <a href=game_programming/same_game_part1.html>
                    <img src=game_programming/same_game_small.png border=0 height=42 width=42 alt="Learn to make a game">
                    <br>
                   How to make a game in 48 hours</a>
                </div>
                

                
                <div class = "sidebar-box">
                   <a href=common.html>
                    <img src=http://static.cprogramming.com/main_images/footer/2291127824_087a497bea_s.jpg border=0 height=75 width=75 alt="Common problems">
                    <br>
                   8 Common Programming Mistakes</a>
                </div>
                

                
                <div class = "sidebar-box">
                   <a href=../c%2b%2b11/what-is-c%2b%2b0x.html>
                    <img src=http://static.cprogramming.com/main_images/footer/c++11.png border=0 height=75 width=75 alt="C++11">
                    <br>
                   What is C++11?</a>
                </div>
                
            </div>
        </div>
        <div style="display:block">
            <a href=../image_credits.html>Image credits</a>
        </div>
    </div>
</div>
</td>  	

</tr>
</table>
</div>


<script>
(function(w, d, s) {
  var cur_url = window.location;
  var loc = cur_url;
  if ( /htm(l?)/.test( cur_url.pathname ) ) {
    loc = cur_url.protocol + "//" + cur_url.host + cur_url.pathname.replace( /\+/g, "%2b" );
  }
  d.getElementById( "fb-recommend" ).setAttribute( "data-href", loc );
  function go(){
    var js, fjs = d.getElementsByTagName(s)[0], load = function(url, id) {
          if (d.getElementById(id)) {return;}
          js = d.createElement(s); js.src = url; js.id = id;
          fjs.parentNode.insertBefore(js, fjs);
        };
    load('http://connect.facebook.net/en_US/all.js#xfbml=1&channelUrl=http%3A%2F%2Fwww.cprogramming.com%2Ffb%2Fchannel.html', 'fbjssdk');
    load('https://apis.google.com/js/plusone.js', 'gplus1js');
    load('http://platform.twitter.com/widgets.js', 'tweetjs');
  }
  if (w.addEventListener) { w.addEventListener("load", go, false); }
  else if (w.attachEvent) { w.attachEvent("onload",go); }
}(window, document, 'script'));
</script>


</body>

<!-- Mirrored from www.cprogramming.com/tutorial/binarysearchbugs.html by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 10 Sep 2012 23:40:16 GMT -->
</html>



